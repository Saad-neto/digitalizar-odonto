# ============================================
# NETLIFY CONFIGURATION
# Digitalizar Odonto - Site + Functions
# ============================================

[build]
  # Comando de build do Vite
  command = "npm run build"

  # Pasta onde o Vite gera os arquivos (dist/)
  publish = "dist"

  # Pasta das functions
  functions = "netlify/functions"

# ============================================
# REDIRECTS E REWRITES
# ============================================

# SPA Fallback: todas as rotas que não forem arquivos devem servir index.html
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

  # Não aplicar a API calls
  conditions = {Role = ["!api"]}

# ============================================
# HEADERS (CORS, Segurança)
# ============================================

[[headers]]
  for = "/api/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"
    Access-Control-Allow-Headers = "Content-Type, stripe-signature"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer-when-downgrade"

# ============================================
# BUILD PLUGINS
# ============================================

# Plugin para processar variáveis de ambiente
[[plugins]]
  package = "@netlify/plugin-nextjs"  # Não é necessário, mas mantém compatibilidade

# ============================================
# VARIÁVEIS DE AMBIENTE (documentação)
# ============================================

# Configure estas variáveis no Netlify Dashboard:
#
# VITE_SUPABASE_URL=https://hkvybshytzgzcrbqngdh.supabase.co
# VITE_SUPABASE_ANON_KEY=eyJhbGci...
# VITE_STRIPE_PUBLIC_KEY=pk_test_...
# STRIPE_SECRET_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_... (obter depois do deploy)
# VITE_PRICE_TOTAL=49700
# VITE_PRICE_ENTRADA=24850
# VITE_PRICE_SALDO=24850
# VITE_APP_URL=https://seu-site.netlify.app
